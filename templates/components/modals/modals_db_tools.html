<div class="modal fade" id="driveModal" tabindex="-1" style="z-index: 1080;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content custom-panel">
            <div class="modal-header border-secondary">
                <h5 class="modal-title"><i class="bi bi-hdd-network me-2"></i>Network Drive Connection</h5>
                <button type="button" class="btn-close btn-close-white" onclick="closeDriveModal()"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label small text-muted">Drive Letter</label>
                        <select id="driveLetter" class="form-select">
                            <option value="Z">Z:</option><option value="Y">Y:</option><option value="X">X:</option><option value="W">W:</option><option value="V">V:</option>
                        </select>
                    </div>
                    <div class="col-md-8">
                        <label class="form-label small text-muted">Network Path</label>
                        <input type="text" id="drivePath" class="form-control" placeholder="\\Server\Share">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label small text-muted">Username</label>
                        <input type="text" id="driveUser" class="form-control" placeholder="Domain\User">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label small text-muted">Password</label>
                        <input type="password" id="drivePass" class="form-control" placeholder="******">
                    </div>
                </div>
                <div id="driveResult" class="mt-3 text-center small"></div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" onclick="closeDriveModal()">Close</button>
                <button type="button" class="btn btn-primary" onclick="submitDriveConnection()">
                    <i class="bi bi-plug-fill me-2"></i>Connect
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="patchModal" tabindex="-1" style="z-index: 1090;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content custom-panel border-warning">
            <div class="modal-header border-secondary">
                <h5 class="modal-title"><i class="bi bi-tools me-2"></i>System Updater</h5>
                <button type="button" class="btn-close btn-close-white" onclick="closePatchModal()"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-dark border-secondary small text-muted mb-3">
                    <i class="bi bi-info-circle-fill me-2"></i>
                    Upload a <code>.diff</code> patch file to update system functionality.
                    <br><span class="text-warning">The page will reload automatically upon success.</span>
                </div>
                
                <div class="mb-3">
                    <label class="form-label small text-light text-uppercase fw-bold">Select Patch File</label>
                    <input class="form-control bg-dark text-light border-secondary" type="file" id="patchFileInput" accept=".diff">
                </div>
                
                <div id="patchError" class="text-danger small fw-bold text-center"></div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" onclick="closePatchModal()">Cancel</button>
                <button type="button" class="btn btn-danger fw-bold" onclick="submitPatchFile()">
                    <i class="bi bi-cloud-upload-fill me-1"></i>Apply Update
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="proceduresModal" tabindex="-1" style="z-index: 1080;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content custom-panel border-warning">
            <div class="modal-header border-secondary">
                <h5 class="modal-title"><i class="bi bi-filetype-sql me-2"></i>Update Procedures</h5>
                <button type="button" class="btn-close btn-close-white" onclick="closeProceduresModal()"></button>
            </div>
            <div class="modal-body">
                <p>This will scan the <code class="text-warning">sql/procedures</code> folder and execute all found scripts against the database.</p>
                <p class="text-muted small">Do you wish to proceed?</p>
                <div id="proceduresResult" class="text-center small"></div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" onclick="closeProceduresModal()">Cancel</button>
                <button type="button" class="btn btn-warning" onclick="submitProcedures()">Yes, Execute</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="dbCompatModal" tabindex="-1" style="z-index: 1080;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content custom-panel border-info">
            <div class="modal-header border-secondary">
                <h5 class="modal-title"><i class="bi bi-database-gear me-2"></i>SQL Compatibility</h5>
                <button type="button" class="btn-close btn-close-white" onclick="closeDbCompatModal()"></button>
            </div>
            <div class="modal-body">
                <p class="small text-muted">Enter the desired Compatibility Level (e.g., 140 for SQL 2017, 150 for SQL 2019).</p>
                <div class="input-group mb-3">
                    <span class="input-group-text bg-transparent border-secondary text-light">Level</span>
                    <input type="number" id="targetCompatLevel" class="form-control border-secondary bg-transparent text-light" placeholder="150">
                </div>
                <div id="dbCompatResult" class="text-center small"></div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" onclick="closeDbCompatModal()">Close</button>
                <button type="button" class="btn btn-info" onclick="submitDbCompat()">Update Level</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="dbDowngradeModal" tabindex="-1" style="z-index: 1090;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content custom-panel border-warning">
            <div class="modal-header border-secondary bg-warning text-dark">
                <h5 class="modal-title"><i class="bi bi-exclamation-triangle-fill me-2"></i>Confirm Downgrade</h5>
            </div>
            <div class="modal-body">
                <p id="dbDowngradeMessage" class="fw-bold">Warning: You are about to downgrade the database compatibility level.</p>
                <p class="small text-muted mb-0">Lowering the compatibility level may disable newer SQL features and impact performance.</p>
                <p class="small text-muted">Are you sure you want to proceed?</p>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" onclick="closeDowngradeModal()">Cancel</button>
                <button type="button" class="btn btn-warning fw-bold" onclick="confirmDowngrade()">Yes, Downgrade</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="alterDbModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg" style="background: #1e1e24; color: #e0e0e0;">
            <div class="modal-header border-bottom border-secondary">
                <h5 class="modal-title fw-bold text-uppercase">
                    <i class="bi bi-database-gear me-2 text-warning"></i>Alter Database Schema
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            
            <div class="modal-body p-0">
                <ul class="nav nav-tabs border-secondary bg-dark px-3 pt-3" id="alterDbTabs" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active small text-uppercase fw-bold" id="tab-fields" data-bs-toggle="tab" data-bs-target="#content-fields" type="button">
                            <i class="bi bi-list-columns me-2"></i>Field Mappings
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link small text-uppercase fw-bold" id="tab-add" data-bs-toggle="tab" data-bs-target="#content-add" type="button">
                            <i class="bi bi-plus-square me-2"></i>Add New Fields
                        </button>
                    </li>
                </ul>

                <div class="tab-content p-0" id="alterDbTabContent">
                    <div class="tab-pane fade show active" id="content-fields" role="tabpanel">
                        <div class="table-responsive" style="max-height: 50vh;">
                            <table class="table table-dark table-striped table-hover table-sm mb-0 align-middle">
                                <thead class="sticky-top bg-secondary text-white">
                                    <tr>
                                        <th class="ps-4" style="width: 40%">Current DB Column</th>
                                        <th style="width: 5%"><i class="bi bi-arrow-right"></i></th>
                                        <th style="width: 40%">New Name (Edit to Rename)</th>
                                        <th style="width: 15%">Type</th>
                                    </tr>
                                </thead>
                                <tbody id="alterDbFieldsBody">
                                    </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="content-add" role="tabpanel">
                        <div class="p-3 bg-dark border-bottom border-secondary d-flex justify-content-between align-items-center">
                            <span class="text-muted small">Define new columns to append to the table.</span>
                            <button class="btn btn-sm btn-success" onclick="alterDbAddNewRow()">
                                <i class="bi bi-plus-lg me-1"></i>Add Row
                            </button>
                        </div>
                        <div class="table-responsive" style="max-height: 45vh;">
                            <table class="table table-dark table-sm align-middle mb-0">
                                <thead>
                                    <tr>
                                        <th class="ps-4">Column Name</th>
                                        <th>Data Type</th>
                                        <th>Default Value (Optional)</th>
                                        <th class="text-end pe-4">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="alterDbAddBody">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="alterDbPreviewContainer" class="d-none bg-black border-top border-secondary p-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <label class="text-warning small fw-bold font-monospace">SQL PREVIEW</label>
                        <button class="btn btn-xs btn-outline-secondary" onclick="copyAlterDbSql()">Copy</button>
                    </div>
                    <pre id="alterDbSqlOutput" class="text-success small font-monospace m-0" style="max-height: 150px; overflow-y: auto; white-space: pre-wrap;"></pre>
                </div>
            </div>

            <div class="modal-footer border-top border-secondary justify-content-between bg-dark">
                <div class="d-flex align-items-center">
                    <button id="btnAlterDbPreview" class="btn btn-sm btn-outline-warning d-none me-2" onclick="alterDbGeneratePreview()">
                        <i class="bi bi-code-square me-1"></i>Generate Preview
                    </button>
                    <span id="alterDbStatus" class="text-muted small fst-italic">Loading...</span>
                </div>
                <div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning fw-bold" onclick="alterDbRun()" id="btnAlterDbRun">
                        <i class="bi bi-lightning-charge-fill me-1"></i>Execute Changes
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>