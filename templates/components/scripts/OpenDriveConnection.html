<script>
    function openDriveModal() { closeAllModals(); if(driveModal) driveModal.show(); }
    function closeDriveModal() { if(driveModal) driveModal.hide(); document.getElementById('driveResult').innerHTML = ''; }
    function submitDriveConnection() {
        const btn = document.querySelector('#driveModal .btn-primary');
        const resultDiv = document.getElementById('driveResult');
        btn.disabled = true; btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Connecting...'; resultDiv.innerHTML = '';
        fetch('/api/tools/connect-drive', { 
            method: 'POST', headers: {'Content-Type': 'application/json'}, 
            body: JSON.stringify({
                drive_letter: document.getElementById('driveLetter').value,
                network_path: document.getElementById('drivePath').value,
                username: document.getElementById('driveUser').value,
                password: document.getElementById('drivePass').value
            })
        }).then(r => r.json()).then(d => {
            btn.disabled = false; btn.innerHTML = '<i class="bi bi-plug-fill me-2"></i>Connect';
            if (d.success) { resultDiv.innerHTML = `<span class="text-success fw-bold"><i class="bi bi-check-circle me-2"></i>${d.message}</span>`; setTimeout(closeDriveModal, 2000); } 
            else { resultDiv.innerHTML = `<span class="text-danger"><i class="bi bi-exclamation-circle me-2"></i>${d.message}</span>`; }
        }).catch(e => { btn.disabled = false; resultDiv.innerHTML = `<span class="text-danger">Request Failed</span>`; });
    }
</script>